# Attila新技术蓝图

## 概要

随着区块链技术的不断发展，Attila一直紧跟行业步伐。我们致力于提供一个开放的算法治理的分布式系统，以此来为链上应用提供强有力的支持。我们的深入研究有关密码学与共识机制，在这个重要的时刻来临之前，让我们一起展望Attila未来将会如何发展。

- 神经网络模型

  `我们为底层计算机节点之间的交互设计了一套完备的模型。组件网络看起来有一些像搭建积木，底层是基于硬件节点的独立数据中心。这些节点机器组合起来创建元网。Attila 采用新型的神经网络系统 (NNS)，负责控制、和管理网络的结构与功能，数据中心通过向NNS申请加入网络。NNS负责网络权限的管理与建设，为新加入的节点授予令牌。这有点像互联网上的域名系统，它为那些想要加入 Attila 网络的节点提供身份证明。NNS 还负责监管节点，在它们出现性能问题或者错误的时候即时更新网络拓扑结构，为网络提供额外的健壮性保证。NNS 在Token 经济中也扮演着至关重要的角色，NNS 生成的治理 Token(dATT)，来奖励运行数据中心和参与治理的节点。智能合约开发者和使用者在使用网络中的底层组件时，需要向数据中心和 NNS 节点支付 ATT 或者 dATT，其中一部分会被燃烧掉。这个机制会让整个系统的经济保持稳定。`

- 元网

  `元网是组成NNS的基本模块，NNS通过将来自不同数据中心的节点机器控制拟合在一起成为元网。这些节点机器通过 Attila 协议进行协作，以便同步与它们托管的软件容器相关的数据和计算。Attila 协议够使用拜占庭容错技术和密码学来确保元网是防篡改和不可逆的。尽管元网是整个 Attila 网络的基本构建块，但它们对用户和智能合约无感的，用户和智能合约只需知道容器的 ID 即可调用其公开的函数。这种无感是互联网基本设计原则的延伸。在互联网上，如果用户想要连接到某些软件，他们只需要知道运行该软件的机器的IP地址和该软件正在侦听的 TCP 端口。在 Attila 网络中，如果用户想要调用一个函数，他们只需要知道容器的 ID 和函数签名。Attila 为软件创建了一个无缝的世界，任何获得许可的软件都可以直接调用任何其他软件，而无需关注网络的底层工作原理。Attila 协议还以其他方式确保元网的透明性。例如，NNS 可以拆分和合并元网，以平衡整个网络的负载，这对于托管的容器也是透明的。当开发者部署智能合约时，必须选择特定的元网类型，例如“数据”、“系统”或“治理”。每个元网类型为开发者的智能合约提供特定的属性和功能。如果合约托管在数据元网上，它可以处理调用，但不能调用其他合约。而一个系统元网则可以调用其它合约。如果要让合约能够将持有的 ATT 或 dATT 代币送到其他合约，您将需要一个治理元网。所以，治理合约只能部署在治理元网上。元网的功能区分有助于增强底层的容错性，同时也能让开发者专注于特定的目标。`

- 容器

  `容器托管在元网之上。容器的运行受到极细粒度的监控，并通过公开的 API 进行交互。容器内部是由字节码和存储字节码的内存页面组成。字节码通常是通过编译某种语言得到（如 Go 或者 Python）。字节码运行在容器之中，使开发人员可以轻松地通过 API 与之交互。在 ATT 网络中，容器提供的接口包含两种：查询接口和更新接口。它们的本质区别在于，当调用更新接口时，它对容器内存中的数据做的任何更改都将保留；而如果调用一个查询函数，则它对数据所做的任何更改都将在运行后被丢弃。更新调用后数据将在 ATT 网络的协调下持久化到链上。调用将在全局调用一致的顺序下进行，使用允许在完全确定性执行环境中并发执行的机制，更新调用仅需两秒即可完成。另一方面，查询调用不会持久化更改。他们对内存所做的任何更改在运行后都会被丢弃。它们非常高效并且价格低廉，只需几毫秒即可完成，这是因为它们不会在元网中的所有节点上运行。`

- 扩展性

  `传统互联网的扩容方案通常是横向扩展，例如创建容器的大量副本，然后将用户内容分片到不同的容器中。不幸的是，由于种种原因，这种架构过于简单。确实，每个额外的容器都会增加整体的内存容量、更新和查询调用吞吐量。但是我们无法为特定用户的内容扩展查询调用请求。每当我们通过添加更多容器分片来增加系统容量时，我们还需要重新平衡用户内容，这并不是一个很好的边缘计算架构。也没有办法让用户请求到最近的容器。所以，我们将同时需要前端和后端容器。ATT 提供了一些有用的功能，用于将用户连接到前端容器。其中一种方法就是通过 NNS 将域名映射到多个前端容器。当最终用户希望解析这样的域名时，NNS 会查看托管前端容器的所有元网中的副本节点，并返回最接近的副本节点的 IP 地址。样用户就能在附近的副本上执行查询、更新，减少网络延迟大大提高用户体验，而无需内容分发网络。`


# 神经网络 NNS

  `通过统筹管理世界各地的独立数据中心，ATT 网络运行开发者在上面部署智能合约，构建可交互的软件。ATT 网络的关键特征是神经网络系统（NNS），这是一个开放的算法治理系统，负责监督网络和代币经济，它使得在网络中构建区中心化的金融、应用、企业级系统和超大规模的软件成为可能。dATT 代币的持有者可以将他们的代币锁定在神经网络节点中，以参与治理并为决策做出贡献，例如投票决定是否应将新的节点集合（元网）添加到网络中。通过参与治理，投票者可以获得奖励。开发者可以使用这些奖励，或通过交易获得的 ATT 代币，来驱动他们的智能合约完成计算和存储功能。`

- 为什么需要 NNS

  `ATT 是一个底层节点网络运行的分布式协议，这些节点托管在不同的数据中心。它们通过互联网相互通信，以实现对 ATT 网络计算机状态的共识。参与共识的节点的集合被称为元网。 在这个底层通信和共识协议的基础上，节点承载智能合约，它们是有状态的程序，也可以相互通信。所有智能合约的状态必须在所有的节点上进行复制。因此，为了使互联网计算机能够无限地扩展，网络不是由一个元网，而是由多个元网组成。不同的元网可以相互通信，使托管在不同元网上的智能合约也可以相互通信。为了使 ATT 网络能够按需扩展，网络必须能够随着时间的推移增加新的元网以提高计算能力。此外，元网的健壮性也可以通过逐渐增加新的节点来提高。最终，ATT 网络将能够大规模地运行数百万个节点。所以，需要有一种机制来组织、跟踪和管理这些数量庞大节点和元网。例如，必须决定何时应该增加或删除节点和元网。此外，节点启动时有一个初始的功能集，它可能会随着时间的推移而发展。因此，ATT 网络需要能够就如何以分布式方式发展协议做出决定。`

## NNS 概述

  `神经网络 NNS 是一种代币化的开放治理系统，负责管理 ATT 网络。例如，它存储有关哪些节点属于哪个元网的信息。它还决定如何更新此信息。在高层次上，NNS 是由一组智能合约实现的。对于做出决定，其中两个智能合约是关键：
  1.治理合约，它存储两种信息：a.提案，这是关于应如何更改 ATT 网络的提案，然后可以对这些提案进行投票；b.神经元，决定谁可以参与治理。
  2.注册表合约：它存储整个 ATT 网络的配置，然后其他人可以查找这些配置。例如，它存储哪些节点属于某个元网。`

- 通过 NNS 进行决策
  
  `现在让我们通过 NNS 的决策剖析来看看如何提出、投票和实施改变协议。假设我们有用户 A 控制神经元 A 并提交关于将节点 N 添加到元网 1 的提案。然后该提案将被添加到治理合约中。其他也控制 NNS 的用户可以对提案进行投票。如果大多数用户支持该提案，则该提案将被执行，这意味着注册表合约的内容将被更新以反映节点 N 是元网 1 的一部分。
  ATT 网络支持各种不同的提案主题。以下是最初支持的主题的一些非详尽示例：
元网管理提案：这会考虑网络拓扑的变更。上面关于是否应将节点添加到元网的示例提案属于这一类。
交易费率提案：这涉及有关 ATT 实例程序 Token 价值的实时信息，这对于确定必须将多少代币转换为计算周期很重要。
节点治理提案：这涉及底层节点的管理。提案的一个示例可以指定元网中的所有节点都应该更新。
网络经济提案：这涉及网络经济学的管理。例如：应该向节点机器提供者支付什么奖励。`

- NNS 代币治理

  `让我们更详细地了解 NNS 上的容器以及它们的工作原理。作为理解神经元概念的先决条件，我们现在将研究用于参与治理系统的 dATT 治理代币。
  代币由 NNS 上的另一个容器管理，即账本容器，它存储两种信息：账户和交易。帐户记录跟踪给定主体 ID（即，用户在 ATT 网络上进行身份验证的身份）拥有多少代币。然后可以将代币从一个账户发送到另一个账户，这会记录在分类账本合约的交易中。
  dATT 治理代币可用于三种不同的用途：
  首先，代币促进了治理的参与（更多关于神经元与代币关联参考下文）。
  其次，参与治理的人和通过操作节点提供计算能力的人都能获得代币奖励。
  最后，代币用于计算的 Gas 消耗，这是用于计算和数据存储的只能合约的燃料。`

## NNS 神经元

- 神经元简介
  
  `神经元包含锁定的代币，这些代币不能自由地转让给他人。
  在神经元存储的其他数据中包含以下信息：
  1.跟踪与给定神经元相关联的代币数量，并通过引用分类帐上的帐户来实现。
  2.指定首要 ID，它是公钥的标识。
  3.指定了唯一的神经元 ID。
  还有一些与神经元相关的其他参数需要注意。最重要的参数之一是可以解锁代币的最早日期。只有那些代币锁定至少六个月的神经元才能参与治理。这应该会激励神经元持有者投票，以便让他们的代币价值在未来日期最大化。
  如果代币的价值大致代表了网络的成功，这将会激励选民为 ATT 网络的长期利益投票。
  神经元的投票权取决于多种因素，包括锁定在神经元中的代币数量以及可以解锁代币的剩余时间。`
  
-- 如何将 Token 锁定在神经元中

  `假设用户 A 在分类账本合约上有一个账户(A1)，A 想要在一个神经元中锁定一百个 Token。为此，用户 A 向 NNS 发送一个命令，指定 Token 数量和用户 A 的相应主体 ID。 然后在账本上提交一笔交易，将一些代币从用户的原始账户 (A1) 发送到新账户 (A2)，这一步同时也创建了持有锁定代币的新账户 (A2)。在治理合约中创建一个新神经元，指定用户 A 是控制该神经元的人，并指定锁定代币的数量由新分类帐本帐户 A2 定义。
从外部看，新账户 (A2) 持有锁定的代币或与原始账户 (A1) 的任何关联是不可见的。然而，这个账户实际上是由神经元控制的，这意味着代币没有流动性，用户 A 不能转移代币或将代币转换成 gas。
控制神经元使用户能够提交提案并对其进行投票，下面我们将对此进行详细说明。`

-- 通过 NNS 进行提案

  `提案定义了当提案被接受时调用的智能合约的方法和调用方法的参数。让我们来看看用户 B 提案创建一个新元网的示例，该元网最初由两个节点组成：节点1和节点2。一旦用户控制了一个神经元，他们就可以通过指定他们的神经元 ID、他们想要提交的提案类型以及提案的参数来进行提案。在我们的示例中，用户 B 提交了创建一个新元网的提案，该元网由初始节点节点 1 和节点 2（提案的参数）组成。
收到此提案后，治理合约首先检查该用户是否确实是控制具有给定 ID 的神经元的人，并且该神经元有资格投票。如果满足要求，则将提案添加到治理容器中。当用户添加新提案时，与给定提案相关联的“是”票数会因提案人的投票权而增加。这反映了提案已经得到了提交它的用户的支持。
为了避免被无用的提案淹没，如果提案被拒绝，提交提案的用户必须支付少量费用。
在提交提案并将其添加到治理合约后，控制神经元的其他用户可以对其进行投票。要投票，用户首先要向治理合约询问未决提案，以了解他们实际上可以投票的内容。
假设给定的用户 D 想要拒绝用户 B 刚刚添加的提案。为此，用户 D 将向治理合约发送他们的神经元 ID 和“否”票。同样，治理合约将检查投票是否来自控制神经元的正确用户，并确认神经元有资格投票。如果满足条件，则治理合约会将用户 D 的投票权添加到“否”票中。
假设在某一时刻，大多数投票权支持该提案。该提案将被执行，这意味着将调用所描述的方法。在该示例中，将使用指定的参数调用为创建元网的方法。结果是一个新的元网被添加到系统中，它由给定的节点 Node1 和 Node2 组成。`
